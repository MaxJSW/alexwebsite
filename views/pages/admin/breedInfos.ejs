<!doctype html>
<html lang="fr" data-bs-theme="auto">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Fiche Infos Races</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://kit.fontawesome.com/1365cc5822.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <link rel="stylesheet" href="/admin/css/dashboard.css">
    <link rel="stylesheet" href="/admin/css/breedInfos.css">
    <link rel="stylesheet" href="/admin/css/sidebar.css">
    <link rel="stylesheet" href="/admin/css/dashboard-modern.css">
    <script src="/admin/js/themes/darkThemeFunction.js"></script>
</head>
  <body>
    <%- include('../admin/composants/header') %>
    <%- include('../admin/composants/topBar') %>
    <div class="container mt-5" style="min-height: 800px;">
      <div class="row">
          <div class=" col-12 row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="blog-list">
              <%- include('./partials/breedList') %>
          </div>
      </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
<script src="/admin/js/utilities/titleFunction.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="/admin/js/breedInfos/breedInfosFunction.js"></script>
<script src="/admin/js/breedInfos/breedPhotosFunction.js"></script>

<!-- modale de modification de la race + description + paragraphe -->
<div class="modal fade modal-fullscreen" id="editBreedInfos" tabindex="-1" aria-labelledby="editBreedInfosLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editBreedInfosLabel">Modifier la race</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="container modal-body">
              <form id="editBreedForm">
                  <div class="mb-3">
                      <label for="editBreedName" class="form-label">Race</label>
                      <input type="text" class="form-control" id="editBreedName" name="name" readonly>
                  </div>
                  <div class="mb-3">
                      <label for="editBreedDescription" class="form-label">Description globale de la race</label>
                      <textarea class="form-control" id="editBreedDescription" name="description" rows="8" placeholder="Faites une description de la globale de la race"></textarea>
                  </div>
                  <hr>
                  <div id="paragraphContainer"></div>
                  <button type="button" class="btn btn-secondary" id="addParagraphButton">Ajouter un paragraphe</button>
                  <input type="hidden" id="editDateModification" name="date_modification" >
                  <input type="hidden" id="editBreedId" name="id">
              </form>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
              <button type="button" class="btn btn-primary" id="saveEditButton">Enregistrer les modifications</button>
          </div>
      </div>
  </div>
</div>

<!-- modale pour la mise en ligne de la fiche race -->
<% breeds.forEach(breed => { %>
  <div class="modal fade" id="ConfirmOnlineBreed-<%= breed.id %>" tabindex="-1" aria-labelledby="ConfirmOnlineArticleLabel-<%= breed.id %>" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="ConfirmOnlineArticleLabel-<%= breed.id %>">Confirmation</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <div class="d-flex justify-content-center">
                      <h5 class="mb-4 text-primary"><%= breed.name %></h5>
                  </div>
                  <p>Etes-vous sûr de vouloir placer la fiche race en ligne ?</p>
                  <p>Veuillez vérifier les points suivants avant de confirmer :</p>
                  <ul class="list-unstyled">
                      <li>
                          <input type="checkbox" id="checkTitle-<%= breed.id %>" class="form-check-input-confirm">
                          <label for="checkTitle-<%= breed.id %>" class="form-check-label">La race est elle correctement orthographié</label>
                      </li>
                      <li>
                          <input type="checkbox" id="checkContent-<%= breed.id %>" class="form-check-input-confirm">
                          <label for="checkContent-<%= breed.id %>" class="form-check-label">Le contenu est complet et sans erreurs</label>
                      </li>
                      <li>
                          <input type="checkbox" id="checkImage-<%= breed.id %>" class="form-check-input-confirm">
                          <label for="checkImage-<%= breed.id %>" class="form-check-label">Les images sont ajoutées</label>
                      </li>
                  </ul>
                  <div id="successConfirmOnlineBreed<%= breed.id %>" class="alert alert-success mt-2 p-2" role="alert" style="display: none;">La fiche race est désormais en ligne ! </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                  <button type="button" class="btn btn-danger confirm-online-button-final" data-id="<%= breed.id %>" disabled>Mettre en ligne</button>
              </div>
          </div>
      </div>
  </div>
  <% }); %>

<!-- modale pour l'ajout des photos de la race -->
<% breeds.forEach(breed => { %>
    <div class="modal fade" id="addBreedPhotoModal-<%= breed.id %>" tabindex="-1" aria-labelledby="addBreedPhotoModalLabel-<%= breed.id %>" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addBreedPhotoModalLabel-<%= breed.id %>">Ajouter des photos à la fiche race</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="container modal-body" style="max-width: 700px; margin: 0 auto;">
                    <form id="addPhotoForm-<%= breed.id %>" enctype="multipart/form-data">
                        <!-- Bouton de téléchargement EN HAUT -->
                        <button type="button" class="btn btn-primary mb-3 upload-photo-button w-100" data-breed-id="<%= breed.id %>">
                            <i class="bi bi-cloud-upload"></i> Télécharger une nouvelle photo
                        </button>
                        <input type="file" class="form-control d-none photo-input" data-breed-id="<%= breed.id %>" accept="image/*">
                        
                        <hr>
                        
                        <!-- Container des photos existantes EN DESSOUS -->
                        <h6 class="mb-3">Photos de la race :</h6>
                        <div id="photoContainer-<%= breed.id %>" class="photo-container">
                            <!-- Les photos seront chargées ici dynamiquement -->
                        </div>
                        
                        <input type="hidden" id="breedId-<%= breed.id %>" name="breedId" value="<%= breed.id %>">
                        <div id="successModalPhotoMessage-<%= breed.id %>" class="alert alert-success mt-3" role="alert" style="display: none;">
                            <i class="bi bi-check-circle"></i> Les modifications ont bien été enregistrées
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
<% }); %>

<!-- Modal de recadrage d'image -->
<div class="modal fade" id="cropperModal" tabindex="-1" aria-labelledby="cropperModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cropperModalLabel">Recadrer la photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="cropper-container-wrapper" style="max-height: 500px; overflow: hidden;">
                    <img id="imageToCrop" style="max-width: 100%;">
                </div>
                <div class="mt-3">
                    <label for="photoAltText" class="form-label">Balise Alt (description de l'image) *</label>
                    <input type="text" class="form-control" id="photoAltText" placeholder="Exemple: Chiot Golden Retriever jouant dans le jardin" required>
                    <small class="form-text text-muted">Cette description aide au référencement et à l'accessibilité</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="cropAndUploadBtn">Valider et télécharger</button>
            </div>
        </div>
    </div>
</div>

<!-- Container pour les toasts (notifications en haut à droite) -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <!-- Toast de succès -->
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-check-circle-fill me-2"></i>
                <span id="successToastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    
    <!-- Toast d'erreur -->
    <div id="errorToast" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span id="errorToastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    
    <!-- Toast d'avertissement -->
    <div id="warningToast" class="toast align-items-center text-bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-exclamation-circle-fill me-2"></i>
                <span id="warningToastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Modal de confirmation de suppression -->
<div class="modal fade" id="confirmDeletePhotoModal" tabindex="-1" aria-labelledby="confirmDeletePhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmDeletePhotoModalLabel">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    Confirmer la suppression
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-0">Êtes-vous sûr de vouloir supprimer définitivement cette photo ?</p>
                <p class="text-muted small mb-0 mt-2">Cette action est irréversible.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i> Annuler
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeletePhotoBtn">
                    <i class="bi bi-trash me-1"></i> Supprimer
                </button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
