<!doctype html>
<html lang="fr" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noindex">
        <meta name="robots" content="noindex, nofollow">
        <title>Profil chiot(s)</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
        <script src="https://kit.fontawesome.com/1365cc5822.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/admin/css/dashboard.css">
        <link rel="stylesheet" href="/admin/css/sidebar.css">
        <link rel="stylesheet" href="/admin/css/dashboard-modern.css">
        <link rel="stylesheet" href="/admin/css/puppysProfile.css">
        <script src="/admin/js/themes/darkThemeFunction.js"></script>
    </head>
    <body>
        <%- include('../admin/composants/header') %>
        <%- include('../admin/composants/topBar') %>
        <div class="container text-center mt-1">
            <h4 class="fw-light">Mariage de : <%= puppy.father_name %> et <%= puppy.mother_name %></h4>
            <p class="small text-body-secondary">Cliquez sur les étiquettes de chaque chiot à gauche pour compléter, modifier ou éditer leur(s) profil(s) respectif(s)</p>
        </div>
        <hr >
        <div class="me-2 mb-2 ms-2">
            <a href="/admin/addPuppys" class="btn btn-outline-primary btn-rounded ms-3" data-mdb-ripple-init data-mdb-ripple-color="dark">Retour au Mariages</a>
        </div>
        <div class="container-fluid p-1 mb-5">
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12">
                    <div class="row">
                        <% if (puppies.length > 0) { %>
                        <% for (let i = 0; i < male.length; i++) { %>
                        <div class="col-12 mb-2">
                            <div class="card border rounded puppy-card" data-puppy-id="<%= male[i].id %>" data-puppy-gender="male" data-marriage-id="<%= marriage.id %>">
                                <div class="card-content">
                                    <div class="card-body">
                                        <div class="media d-flex">
                                            <div class="media-body text-left">
                                                <p><strong>Nom:</strong> <span class="puppy-name"><%= male[i].puppy_name || 'En Attente' %></span></p>
                                                <p><strong>Couleur:</strong> <span class="puppy-color"><%= male[i].puppy_color || 'En Attente' %></span></p>
                                            </div>
                                            <div class="ms-auto p-3">
                                                <i class="bi bi-gender-male fa-2x" style="color: blue;"></i>
                                            </div>
                                        </div>
                                        <div class="progress mt-1 mb-0" style="height: 7px;">
                                            <div class="progress-bar bg-primary" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %>
                        <% for (let i = 0; i < female.length; i++) { %>
                        <div class="col-12 mb-2">
                            <div class="card border rounded puppy-card" data-puppy-id="<%= female[i].id %>" data-puppy-gender="female" data-marriage-id="<%= marriage.id %>">
                                <div class="card-content">
                                    <div class="card-body">
                                        <div class="media d-flex">
                                            <div class="media-body text-left">
                                                <p><strong>Nom:</strong> <span class="puppy-name"><%= female[i].puppy_name || 'En Attente' %></span></p>
                                                <p><strong>Couleur:</strong> <span class="puppy-color"><%= female[i].puppy_color || 'En Attente' %></span></p>
                                            </div>
                                            <div class="ms-auto p-3">
                                                <i class="bi bi-gender-female fa-2x" style="color: pink;"></i>
                                            </div>
                                        </div>
                                        <div class="progress mt-1 mb-0" style="height: 7px;">
                                            <div class="progress-bar bg-pink" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-xs-12">
                    <div id="puppyProfileContainer">
                        <% if (puppies.length > 0) { %>
                        <%- include('./partials/puppyProfile', { 
                            puppy: puppies[0], 
                            isAnyPuppyOnline: isAnyPuppyOnline,
                            father_name: puppies[0].father_name,
                            mother_name: puppies[0].mother_name,
                            country_name: puppies[0].country_name, // passer cette valeur dans le fichier dynamique
                            breed_name: puppies[0].breed_name, // passer cette valeur dans le fichier dynamique
                            marriage: marriage,
                            formatted_puppy_birth_date: puppies[0].formatted_puppy_birth_date,
                            formatted_available_date: puppies[0].formatted_available_date
                            }) %>
                        <% } else { %>
                        <p>Aucun chiot n'a été trouvé pour ce mariage.</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
        <script src="/admin/js/utilities/titleFunction.js"></script>
        <script src="/admin/js/forms/puppiesProfileFunction.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script>
        function adjustDateForInput(dateString) {
                const date = new Date(dateString);
                // Ajuster le décalage de fuseau horaire
                return new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().substring(0, 10);
            }
        
            document.addEventListener('DOMContentLoaded', function() {
                const puppyBirthDateInput = document.getElementById('puppy_birth_date');
                const puppyBirthDate = '<%= puppy.puppy_birth_date ? puppy.puppy_birth_date.toISOString() : "" %>';
                
                if (puppyBirthDate) {
                    puppyBirthDateInput.value = adjustDateForInput(puppyBirthDate);
                }
            });
            
        </script>
        <div class="modal fade" id="inBreedingModal" tabindex="-1" aria-labelledby="inBreedingModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="inBreedingModalLabel">Informations sur l'élevage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Les animaux faisant partie de l'élevage sont les chiots devenus adultes qui ont intégré votre cheptel de reproducteurs et sont devenus des membres essentiels de votre élevage. Si les chiots sont destinés à la vente, ils n'en font pas partie. Dans ce cas, veuillez sélectionner "Non". Ce champ n'est pas visible par les visiteurs de votre site.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <% puppies.forEach(function(puppy) { %>
        <div class="modal fade" id="uploadPuppiesProfileModal-<%= puppy.id %>" tabindex="-1" aria-labelledby="uploadPuppiesProfileModalLabel-<%= puppy.id %>" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="uploadPuppiesProfileModalLabel-<%= puppy.id %>">Télécharger une nouvelle image</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="uploadProfileForm" enctype="multipart/form-data" data-puppy-id="<%= puppy.id %>" data-marriage-id="<%= marriage.id %>">
                            <div class="mb-3">
                                <label for="profileImageInput-<%= puppy.id %>" class="form-label">Choisir une image</label>
                                <input type="file" class="form-control" id="profileImageInput-<%= puppy.id %>" name="profileImage" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Télécharger</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <% }); %>
        <% } else { %>
        <p>Aucune modale n'a été trouvé pour ce mariage.</p>
        <% } %>
        <!-- Modal de recadrage des photos du chiot -->
        <div class="modal fade" id="cropPuppyPhotoModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">✂️ Recadrer la photo</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <img id="cropPuppyPhotoImage" style="max-width: 100%;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" class="btn btn-primary" id="saveCropPuppyPhotoBtn">
                            <i class="bi bi-check-lg"></i> Enregistrer
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal de recadrage de la photo de profil -->
        <div class="modal fade" id="cropProfileModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">✂️ Recadrer la photo de profil</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <img id="cropProfileImage" style="max-width: 100%;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" class="btn btn-primary" id="saveCropProfileBtn">
                            <i class="bi bi-check-lg"></i> Enregistrer
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <% puppies.forEach(function(puppy) { %>
        <!-- Modale pour confirmer la suppression de la photo de profil -->
        <div class="modal fade" id="deletePuppiesProfileImageModal-<%= puppy.id %>" tabindex="-1" aria-labelledby="deletePuppiesProfileImageModalLabel-<%= puppy.id %>" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletePuppiesProfileImageModalLabel-<%= puppy.id %>">Confirmer la suppression</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Êtes-vous sûr de vouloir supprimer cette photo de profil ? Cette action est irréversible.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" id="confirmDeleteButton-<%= puppy.id %>" class="btn btn-danger">Supprimer</button>
                    </div>
                </div>
            </div>
        </div>
        <% images.forEach(image => { %>
        <!-- Modal de confirmation de suppression de photo -->
        <div class="modal fade" id="deletePhotoModal-<%= puppy.id %>-<%= image.id %>" tabindex="-1" aria-labelledby="deletePhotoModalLabel-<%= image.id %>" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletePhotoModalLabel-<%= image.id %>">Confirmation de suppression</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Êtes-vous sûr de vouloir supprimer cette photo ?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteButton-<%= puppy.id %>-<%= image.id %>" data-photo-id="<%= image.id %>" data-photo-path="<%= image.image_path %>" data-puppy-id="<%= puppy.id %>">Supprimer</button>
                    </div>
                </div>
            </div>
        </div>
        <% }); %>
        <% }); %>
    </body>
</html>